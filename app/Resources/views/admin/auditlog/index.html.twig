{% extends 'layout.html.twig' %}

{% block title %}Logs de modification des créneaux - {{ site_name }}{% endblock %}

{% block breadcrumbs %}
<a href="{{ path('homepage') }}"><i class="material-icons">home</i></a><i class="material-icons">chevron_right</i>
<a href="{{ path('admin') }}"><i class="material-icons">build</i>&nbsp;Administration</a><i class="material-icons">chevron_right</i>
<i class="material-icons">list</i>&nbsp;Logs
{% endblock %}

{% block content %}
    <h4>Logs</h4>

    <table class="responsive-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Qui</th>
                <th>Entitée</th>
                <th>Id</th>
                <th>Action</th>
                <th>Route</th>
                <th>Donnée</th>
            </tr>
        </thead>

        <tbody>
        {% for auditLog in auditLogs %}
            <tr>
                <td>
                    {{ auditLog.createdAt|date('Y-m-d H:i:s') }}
                </td>
                <td>
                    {% if auditLog.user and auditLog.user.beneficiary %}
                        <a href="{{ path("member_show",{'member_number': auditLog.user.beneficiary.membership.memberNumber}) }}">
                            {{ auditLog.user.beneficiary }}
                        </a>
                    {% else %}
                        {{ auditLog.user }}
                    {% endif %}
                </td>
                <td>{{ auditLog.entityType }}</td>
                <td>{{ auditLog.entityId }}</td>
                <td>{{ auditLog.action }}</td>
                <td>{{ auditLog.requestRoute }}</td>
                {% set eventData =  (auditLog.action == "update") ? auditLog.eventData | map(ed => (ed.from is defined) ? "#{ed.from} → #{ed.to}" : ed) : auditLog.eventData %}
                <td>{{ eventData | json_encode(constant('JSON_PRETTY_PRINT') b-or constant('JSON_UNESCAPED_UNICODE') b-or constant('JSON_UNESCAPED_SLASHES')) }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <ul class="pagination">
        <li class="{% if(current_page==1) %}disabled{% else %}waves-effect{% endif %}">
            <a href="{% if(current_page==1) %}#!{% else %}{{ path("admin_shiftlog_index",{'page':current_page-1}) }}{% endif %}">
                <i class="material-icons">chevron_left</i>
            </a>
        </li>
        {% for i in range(1,pages_count) %}
        <li class="{% if(current_page==i) %}active{% else %}waves-effect{% endif %}"><a href="{{ path("admin_auditlog_index",{'page':i}) }}">{{ i }}</a></li>
        {% endfor %}
        <li class="{% if(current_page==pages_count) %}disabled{% else %}waves-effect{% endif %}">
            <a href="{% if(current_page==pages_count) %}#!{% else %}{{ path("admin_shiftlog_index",{'page':current_page+1}) }}{% endif %}">
                <i class="material-icons">chevron_right</i>
            </a>
        </li>
    </ul>

{% endblock %}

